<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>electric life</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
 <script
      src="https://kit.fontawesome.com/9d7a2afbd4.js"
      crossorigin="anonymous"
    ></script>
<link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
<link rel="stylesheet" th:href=@{css/w3.css} />
<link rel="stylesheet" th:href=@{css/cgoing.css} />
<link rel="stylesheet" th:href=@{css/jsk.css} />
<script type="text/javascript" src="js/custom.js"></script>
<script src="js/w3.js"></script>
<script src="js/cgoing.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
	<div id="wrapper">
		<!-- common í—¤ë” -->
		<div th:insert="common_header.html :: header"></div>
		<!-- shop/detail -->
		<nav
			class="flex-container flex-center w3-large lnb-margin w3-padding w3-light-grey">

			<a th:href="@{shop(list=p_num,category=1)}" id="one"
				th:class="${dto?.p_category}==1?on_lnb:''" onclick="addOnLnb(this)">ìƒˆì°¨ìš©í’ˆ</a>
			<a th:href="@{shop(list=p_num,category=2)}" id="two"
				th:class="${dto?.p_category}==2?on_lnb:''" onclick="addOnLnb(this)">ìµìŠ¤í…Œë¦¬ì–´</a>
			<a th:href="@{shop(list=p_num,category=3)}" id="three"
				th:class="${dto?.p_category}==3?on_lnb:''" onclick="addOnLnb(this)">ì „ìê¸°ê¸°</a>
			<a th:href="@{shop(list=p_num,category=4)}" id="four"
				th:class="${dto?.p_category}==4?on_lnb:''" onclick="addOnLnb(this)">íƒ€ì´ì–´</a>
		</nav>
		<div class="w3-auto">
			<div class="w3-row-padding w3-padding w3-margin-top"
				style="display: flex">

				<div style="flex-basis: 60%">
					<div class="j-card">
						<!--  <a href="detail.jsp">-->
						<img th:src="@{${dto.img_dir}}" alt="Alps" class="j-image" />
						<div class="w3-container w3-center"></div>
					</div>
					<div class="j-flex-container j-flex-center w3-center">
						<img class="demo w3-opacity w3-hover-opacity-off"
							th:src="@{${dto.img_dir}}" th:onclick="currentDiv(1)" />
					</div>
				</div>
				<div class="w3-half j-detail-padding" style="flex-basis: 40%">
					<div>

						<span id="heart"></span>

					</div>
					<div class="w3-container j-border-bottom">
						<h4 class="w3-right" style="overflow: auto">[[${dto.p_name}]]</h4>
					</div>
					<div class="w3-panel">
						<p class="w3-right w3-tiny">ë“±ë¡ë‚ ì§œ : [[${dto.p_date}]]</p>
					</div>
					<div class="wrap-star w3-right">
						<div class="star-rating">
							<th:block th:if="${reviewStar=='nothing'}">
								<span th:style="width: 0%"></span>
							</th:block>
							<th:block th:unless="${reviewStar=='nothing'}">
								<span th:style="|width: ${reviewStar}%|"></span>
							</th:block>
						</div>
						<h2 class="w3-small c-btn">
							ë¦¬ë·° <span th:text="${reviewCnt}"></span>
						</h2>
					</div>

					<!-- ë³„ì  -->
					<div class="w3-container">
						<h3 class="c-price_font w3-right">[[${#numbers.formatInteger(dto.p_price, 3, 'COMMA')}]]ì›</h3>
					</div>
					<div class="w3-right w3-padding">ì¬ê³  : [[${dto.p_stock }]] ê°œ</div>
					<form th:action="@{/buyProductForm}" method="get">
						<input type="hidden" id="key" value="0" /> <input type="hidden"
							name="id" id="id" th:value="${session.loginUser?.id}" /> <input
							type="hidden" id="p_name" name="p_name" th:value="${dto.p_name}" />
						<input type="hidden" id="p_num" name="p_num" th:value="${p_num}" />
						<input type="hidden" id="p_price" name="p_price"
							th:value="${dto?.p_price}" /> <input type="hidden"
							id="p_category" th:value=${dto?.p_category} /> <input
							type="hidden" id="p_stock" th:value="${dto.p_stock}" /> <input
							type="hidden" id="p_content" th:value="${dto.p_content}">

						<div class="w3-container">
							<div class="w3-right j-updown">
								<input type="button" onclick="downOrderCount('qtt')" value="-" />
								<input type="text" id="qtt" name="quantity" min="0" value="1" />
								<input type="button"
									th:onclick="upOrderCount('qtt',[[${dto.p_stock}]]);" value="+" />
							</div>
						</div>
						<div class="w3-panel">
							<div class="w3-right">
								<span class="w3-small partition-right">í¬ì¸íŠ¸ ì ë¦½í˜œíƒ&nbsp</span> <span
									class="w3-small c-point_color">ìµœëŒ€
									í¬ì¸íŠ¸[[${dto.p_price}/10]] pt ì ë¦½</span>
							</div>
						</div>
						<div class="w3-panel j-border-top">
							<div class="w3-right-align"></div>
						</div>
						<div class="w3-right">
							<input type="button" value="ì°œí•˜ê¸°" th:onclick="pickClick()"
								class="j-btn">
							<th:block th:if="${dto.p_stock <=0}">
								<input type="button" class="j-btn2" value="ë°”ë¡œêµ¬ë§¤"
									onclick="noLongerInStock()" />
							</th:block>
							<th:block th:unless="${dto.p_stock <=0}">
								<th:block th:if="${session.loginUser?.id != null}">
									<button th:onclick="|location.href='@{/buyProductForm}'|"
										class="j-btn2">ë°”ë¡œêµ¬ë§¤</button>
								</th:block>
								<th:block th:unless="${session.loginUser?.id != null}">
									<input type="button" value="ë°”ë¡œêµ¬ë§¤"
										th:onclick="return clickEvent1('buyProductForm')"
										class="j-btn2" />
								</th:block>
							</th:block>
						</div>
					</form>
				</div>
			</div>
			<th:block th:if="${session.loginUser?.lv == 3}">
				<input type="button" th:onclick="productupdateForm()" value="ìˆ˜ì •"
					class="w3-button w3-white w3-border w3-border-theme w3-round w3-right" />
				<input type="button" th:onclick="realDel()" value="ì‚­ì œ"
					class="w3-button w3-white w3-border w3-border-theme w3-round w3-right" />
			</th:block>

			<div class="w3-container">
				<img src="images/cardetail_1.png" >
				<h2>ìƒí’ˆ ìƒì„¸ ì„¤ëª…</h2>
				<img src="images/cardetail_1.png" >
				<p th:utext="${dto.p_content}"></p>
			</div>
			<table class="w3-table w3-bordered w3-border-top">
				<tr class="w3-light-gray">
					<th style="width: 60%" class="w3-center w3-light-gray">ë‚´ìš©</th>
					<th class="w3-light-gray">ì‘ì„±ì</th>
					<th class="w3-light-gray">ë“±ë¡ì¼</th>
					<th class="w3-light-gray">í‰ì </th>
				</tr>

				<th:block th:if="${session.loginUser?.id != null }">
					<div class="j-review-margin">
						<h3 class="w3-left">êµ¬ë§¤í›„ê¸°</h3>
						<a
							th:onclick="|location.href='@{reviewForm(id=${session.loginUser?.id},p_num=${dto?.p_num},category=${category})}'|"
							class="w3-right w3-large j-shop-btn">ğŸ’¬ë¦¬ë·°ì‘ì„±</a>
					</div>
				</th:block>
				<th:block th:unless="${session.loginUser?.id!=null}">
					<div class="j-review-margin">
						<h3 class="w3-left">êµ¬ë§¤í›„ê¸°</h3>
						<a th:onclick="clickEvent('detail');"
							class="w3-right w3-large j-shop-btn"> ğŸ’¬ë¦¬ë·°ì‘ì„±</a>
					</div>
				</th:block>
				<tr class="w3-small" th:each="review : ${reviewreview}">
					<th style="width: 60%" class="w3-center"><span
						th:text="${review.rv_content}" class="w3-large"></span></th>
					<th><span th:text="${review.id}" class="w3-large"></span></th>
					<th><span th:text="${review?.rv_date}" class="w3-large"></span></th>
					<th><span th:text="${review.rv_like}" class="w3-large"></span></th>
				</tr>
			</table>
			<!-- ì•„í‹°í´ -->
			<div>
				<article class="w3-container w3-center"></article>
			</div>
		</div>
		<!-- common í‘¸í„° -->
		<div th:insert="common_footer.html :: footer"></div>
	</div>
	<script th:inline="javascript">	
		$.ajax({
			type: 'post',
			url: './pickCheck',
			data: {
				id : [[${session.loginUser?.id}]],
				p_num : [[${p_num}]]
			},
			success : function(result){
				if(result==1){
					$("#heart").html("<button class='heart-on w3-right' onclick='pickClick()'>ğŸ’—</button> ");
				}else{
					if([[${session.loginUser?.id}]]==null){
						$("#heart").html("<button class='heart-off w3-right' onclick='clickEvent2Inline()'>ğŸ¤</button>");
					}else{
						$("#heart").html("<button class='heart-off w3-right' onclick='pickClick()'>ğŸ¤</button>");
					}
				}
			}
		});		
	</script>

	<script th:inline="javascript">	
	function pickClick(){
		$.ajax({
			type: 'post',
			url: './pickCheck',
			data: {
				id : [[${session.loginUser?.id}]],
				p_num : [[${p_num}]]
			},
			success : function(result){
				if(result==1){
					$("#heart").html("<button class='heart-off w3-right' onclick='pickClick()'>ğŸ¤</button>");
					pickLiseDelete([[${session.loginUser?.id}]],[[${p_num}]]);
				}else{
					if([[${session.loginUser?.id}]]==null){
						clickEvent2('pickshop',[[${p_num}]]);
						("#heart").html("<button class='heart-off w3-right' onclick='pickClick()'>ğŸ¤</button>");
					}
					$("#heart").html("<button class='heart-on w3-right' onclick='pickClick()'>ğŸ’—</button> ");
					pickLiseInsert([[${session.loginUser?.id}]],[[${p_num}]]);
				}
			}
		});		
	}
	
	
	function pickLiseDelete(id, p_num) {
		$.ajax({
			type: 'post',
			url: './pickListDelete',
			data: {
				id: id,
				p_num: p_num
			},
			success: function(result) {
				if (result) {
					console.log("ì°œ ì‚­ì œ ì™„ë£Œ")
				} else {
					console.log("ì‚­ì œ ì‹¤íŒ¨")
				}

			},
			error: function() {
				console.log("ì‚­ì œ ì—°ê²° ì—ëŸ¬")
			}
		});
	}
	function pickLiseInsert(id, p_num) {
		$.ajax({
			type: 'post',
			url: './pickListInsert',
			data: {
				id: id,
				p_num: p_num
			},
			success: function(result) {
				if (result) {
					console.log("ì°œ ì¶”ê°€ ì™„ë£Œ")
				} else {
					console.log("ì¶”ê°€ ì‹¤íŒ¨")
				}

			},
			error: function() {
				console.log("ì¶”ê°€ ì—°ê²° ì—ëŸ¬")
			}
		});
	}
	
	</script>
	<script th:inline="javascript">	
		function clickEvent2Inline(){
			up = confirm("ë¡œê·¸ì¸ í›„ ì´ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
			if(up){
				var p_go = "pickshop";
				var item = [[${p_num}]];
				location.href = "loginForm?go=" + p_go + "&p_num=" + item;
			}else{
				return false;
			}
		}
	</script>
	<script>	
	function noLongerInStock(){
		
		alert("ì¬ê³ ê°€ ë” ì´ìƒ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ êµ¬ë§¤ í•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		
	}
	</script>
</body>
</html>